---
layout: post
title:  "密码学笔记"
date:   2021-05-27 00:00:00 +0800
categories: note
tags: 密码学 笔记
comments: 1
mathjax: true
---

本文为密码学笔记。

[TOC]

# 绪论

## 信息安全面临的威胁

### 安全威胁

- 被动攻击

  也称窃听，以获取信息为目的。可分为两类：获取消息的内容和业务流分析

- 主动攻击

  对数据流进行篡改或产生假的数据流

### 安全业务

- 鉴别业务：也称认证业务，最基本的安全服务，是对付假冒攻击的有效方法，以保障通信的真实性，可细分为对等实体鉴别和数据源鉴别
- 访问控制：用于防止资源的未授权使用，检查用户是否具有对某一资源的访问权
- 机密性业务：保护信息（数据）不泄露或不泄露给那些未获授权访问信息的实体
- 数据完整性业务：保证接收的消息未经复制、插入、篡改、重排或重放。即保证接收的消息和发送的消息完全一样
- 抗抵赖业务：即不可否认性业务，防止通信双方中的某一方对所传送消息的否认，保护通信实体免遭来自其他合法实体的威胁

## 密码学基本概念

### 保密通信系统

<center><img src="https://i.loli.net/2021/05/14/47rhKPwoiSQDMZT.png" alt="image-20210514082213231" style="zoom: 33%;" /></center>

$M$ 表示明文空间、$C$ 表示密文空间；密钥空间为 $K_1$ 和 $K_2$；加密变换 $E_{K_1}$：$M\rightarrow C$ ；解密变换 $D_{K_2}$：$C\rightarrow M$；称 $(M, C, K_1, K_2, E_{K_1}, D_{K_2})$ 为保密通信系统或密码体制

### 密码体制分类

$\text{密码体制}\left\{\begin{array}\text{对称密码体制}\left\{\begin{array}\text{流密码}\\\text{分组密码}\end{array}\right.\\\text{非对称密码体制} - \text{公钥密码}\end{array}\right.$

### 密码攻击

| 攻击类型 | 攻击者掌握的内容 |
| -------- | ---------------- |
| 唯密文攻击 | 加密算法，截获的部分密文 |
| 已知明文攻击 | 加密算法，截获的部分密文，一个或多个明密文对 |
| 选择明文攻击 | 加密算法，截获的部分密文，自己选择的明文消息及由密钥产生的相应密文 |
| 选择密文攻击 | 加密算法，截获的部分密文，自己选择的密文消息及相应的被解密的明文 |

## 古典密码算法

### 单表代换密码

#### 凯撒密码

| $a$  | $b$  | $c$  | $d$  | $e$  | $f$  | $\cdots$ | $z$  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| $0$  | $1$  | $2$  | $3$  | $4$  | $5$  | $\cdots$ | $25$ |

- 加密代换：$c = E_3(m)\equiv m+3 (\mod 26), 0\leq m\leq25$
- 解密代换：$m = D_3(c) \equiv c－3 (\mod 26), 0\leq c\leq25$

#### 移位变换

- 加密变换：$c = E_k(m) \equiv m+k (\mod 26), 0\leq m, k\leq25$
- 解密变换：$m = D_k(c) \equiv c－k (\mod 26), 0\leq c, k\leq25$

#### 仿射变换

$a$, $b$ 是密钥，满足 $0\leq m, k\leq25$ 和 $\gcd(a,26)=1$ 的整数

- 加密变换：$c = E_{a,b}(m) \equiv am+b (\mod 26)$
- 解密变换：$m = D_{a,b} (c) \equiv a^{-1}(c－b) (\mod 26)$

### 多表代换密码

#### 维吉尼亚密码

在长为 $m$ 的密码中,任何一个字母可被映射到 $26$ 个字母中的一个

- 明文 $p \in(Z_{26})^m$, 密文 $c \in (Z_{26})^m$ , 密钥 $k \in (Z_{26})^m$
- 加密 $c= (p_1+k_1 , p_2+k_2 , \cdots, p_m+k_m) \mod 26$
- 解密 $p = (c_1-k_1 , c_2-k_2 ,\cdots, c_m-k_m) \mod 26$

### 多字母代换密码

#### Hill 密码

$m$ 个连续明文字母被 $m$ 个密文字母代替，由 $m$ 个线性方程决定替代方法

$m=3$ 时的系统描述：编码 $(a=0,b=1,\cdots,z=25)$，$ C＝KP$

$\left(\begin{matrix}C_1\\C_2\\C_3\end{matrix}\right)=\left(\begin{matrix}k_{11}&k_{12}&k_{13}\\k_{21}&k_{22}&k_{23}\\k_{31}&k_{32}&k_{33}\end{matrix}\right)\left(\begin{matrix}p_1\\p_2\\p_3\end{matrix}\right)\left(\mod 26\right)$

- 破解：$C=KP\Longrightarrow K=CP^{-1}$

#### 多字母仿射变换密码

- 首先将明文 $M$ 分为由 $n$ 个字母构成的分组 $M_1, M_2, \cdots, M_j$，对每个分组 $M_i$ 的加密为

  $C_i \equiv AM_i + B (\mod N), i=1, 2, \cdots, j$，其中，$(A, B)$ 是密钥，$A$ 是 $n\times n$ 的可逆矩阵，满足 $\gcd(|A|, N) = 1$ ( $|A|$ 是行列式)

  $B＝(b_1, b_2,\cdots, b_n)^T$

  $C_i＝(c_1, c_2,\cdots, c_n)^T$

  $M_i＝(m_1, m_2,\cdots, m_n)^T$

- 对密文分组 $C_i$ 的解密为

  $M_i \equiv A^{-1}(C_i－B) (\mod N), i=1, 2, \cdots ,j$

### 置换密码

又称换位密码，明文字母保持相同，但顺序被打乱了。即对明文字母的某种置换取得一种类型完全不同的映射,即明文中字母重新排列,本身未变,位置发生改变

#### 栅栏密码

- 加密：明文以固定的宽度水平地写在一张图表纸上,密文按垂直方向读出
- 解密：将密文按相同的宽度垂直地写在图表纸上,然后水平地读出明文



# 流密码

## 概念

### 同步流密码

- 由密钥流发生器 $f$ 产生：$z_i ＝f(k, \sigma_i)$，$\sigma_i$ 是加密器中的记忆元件在时刻 $i$ 的状态，可表示为 $\sigma_i = (a_n, a_{n-1}, \cdots, a_1)$
- 按照加密器中记忆元件的存储状态 $\sigma_i$ 是否依赖于明文字符流，流密码可进一步分为同步流密码和自同步流密码
- <img src="https://i.loli.net/2021/05/26/HuVd2815WXsDowS.png" alt="image-20210526222219622" style="zoom: 33%;" />

### 有限状态自动机

- 流密码中任意时刻密钥流和密文的输出与状态密切相关。可用具有离散输入集和输出集的有限状态自动机模型表述

  - 有限状态集：$S=\left\{ s_i | i=1, 2,\cdots, l \right\}$ 共 $l$ 个可能状态

  - 有限输入字符集：$A_1=\left\{A_{j}^{(1)} | j=1, 2, \cdots, m\right\}$ 

    有限输出字符集：$A_2=\left\{A_{k}^{(2)}| k=1, 2 ,\cdots, n\right\}$

  - 输出函数：$A_{k}^{(2)}=f_1\left(s_i , A_{j}^{(1)}\right)$

    状态转移函数：$s_h=f_2\left(s_i , A_{j}^{(1)}\right)$

### 密钥流产生器

- 可将密钥流产生器看成参数为 $k$ 的有限状态自动机，由输出符号集 $Z$、状态集 $\Sigma$ (初始状态 $\sigma_0$ )、状态转移函数 $\varphi$ 和输出函数 $\varPsi$ 构成

  <img src="https://i.loli.net/2021/05/26/8JTybIzpsexoPUj.png" alt="image-20210526224231680" style="zoom: 25%;" />

- 具有非线性的 $\varphi$ 的有限状态自动机理论很不完善，相反，采用线性的 $\varphi$ 和非线性的 $\varPsi$ 时能够进行深入分析并可以得到好的生成器

## 线性反馈移位寄存器

### 反馈移位寄存器

- $\text{GF}(2)$ 上的 $n$ 级 FSR 由 $n$ 个二元存储器与一个反馈函数 $f(a_1, a_2,\cdots,a_n)$ 组成

  <img src="https://i.loli.net/2021/05/26/QV7q6b3deO4gjDX.png" alt="image-20210526224823750" style="zoom: 25%;" />

### LFSR

- $f(a_1,a_2,\cdots,a_n)=c_na_1\oplus c_{n-1}a_2\oplus\cdots\oplus c_1a_n, c_i=0,1$
- 若其初始状态非全 $0$，则其后继状态也不会为全 $0$。因此 $n$ 级 LFSR 此输出序列的周期 $=$ 状态周期 $\leq 2^n-1$
- 周期达到最大值的线性序列称为 m 序列

## LFSR 的一元多项式表示

- 递推关系式 $a_{k+n}=c_1a_{k+n-1}\oplus c_2a_{k+n-2}\oplus\cdots\oplus c_na_k,k\geq1$

  特征多项式 $p(x)=1+c_1x+c_2x^2+\cdots+c_nx^n$

- 记 $a_i$ 的 $2^n-1$ 个非零序列的全体为 $G(p(x))$

- $n$ 级 LFSR 产生的序列有最大周期 $2^n-1$ 的**必要**条件是其特征多项式 $p(x)$ 是不可约的，称这样的多项式为 $n$ 次本原多项式

## m 序列的伪随机性

### 游程

序列中连续的 $0$ 或连续的 $1$ 串称为 $1$ 个游程

### 自相关函数

$R(\tau)=\frac{1}{T}\sum_\limits{k=1}^{T}{ {(-1)}^{a_k}{(-1)}^{a_{k+\tau}}},0\leq\tau\leq T-1$

即为两个序列 $\left\{a_i\right\}$ 与 $\left\{a_{i＋\tau}\right\}$ 在一个周期内对应位相同的位数与不同的位数之差

当 $\tau\neq0$ 时，称 $R(\tau)$ 为异相自相关函数

### 伪噪声序列

好的伪随机序列应满足的 $3$ 个公设

- $0,1$ 平衡性：一个周期内，$0$、$1$ 出现的次数分别为 $2^{n-1}-1$ 和 $2^n-1$（不能全 $0$）
- 游程特性：一个周期内，总游程数为 $2^n-1$；对 $1\leq i\leq n-2$，长度为 $i$ 的游程有 $2^{n-i-1}$ 个，且 $0$、$1$ 游程各半；长度为 $n-1$ 的 $0$ 游程一个，长度为 $n$ 的 $1$ 游程一个
- 自相关函数：$R(\tau)=\left\{\begin{array} 01,&\tau=0\\-\frac{1}{2^n-1},&0<\tau\leq2^n-2\end{array}\right.$

## m 序列的破译

$\begin{aligned}(\begin{matrix}a_{n+1}&a_{n+2}&\cdots&a_{2n}\end{matrix})&=(\begin{matrix}c_n&c_{n-1}&\cdots&c_1\end{matrix})\left(\begin{matrix}a_1&a_2&\cdots&a_n\\a_2&a_3&\cdots&a_{n+1}\\\vdots&\vdots&&\vdots\\a_n&a_{n+1}&\cdots&a_{2n-1}\end{matrix}\right)\\&=(\begin{matrix}c_n&c_{n-1}&\cdots&c_1\end{matrix})X\end{aligned}$

$(\begin{matrix}c_n&c_{n-1}&\cdots&c_1\end{matrix})=(\begin{matrix}a_{n+1}&a_{n+2}&\cdots&a_{2n}\end{matrix})X^{-1}$

## 非线性序列

### 密钥流满足的性质

- 种子密钥的长度足够长
- 极大的周期
- 良好的统计特性
- 极大的线性复杂度
- 极大的 $k$ 错线性复杂度
- 抗统计分析
- 混乱性
- 扩散性
- 抗线性分析

### Geffe 序列生成器

<img src="https://i.loli.net/2021/05/27/aHtQjnbdYfZmKzq.png" alt="image-20210527090029046" style="zoom:20%;" />

当 LFSR~2~ 输出 $1$ 时，LFSR~2~ 与 LFSR~1~ 相连接；当 LFSR~2~ 输出 $0$ 时，LFSR~2~ 与 LFSR~3~ 相连接

周期 $T=\prod_\limits{i=1}^{3}{\left(2^{n_i}-1\right)}$

### J-K 触发器

<img src="https://i.loli.net/2021/05/27/tjoFbdA8Hk9GzyN.png" alt="image-20210527090713636" style="zoom:20%;" />

### Pless 生成器

<img src="https://i.loli.net/2021/05/27/2jBVJauUgnhADzx.png" alt="image-20210527090845532" style="zoom:33%;" />

输出序列为 $a_0b_1c_2d_3a_4b_5c_6\cdots$

### 钟控序列生成器

<img src="https://i.loli.net/2021/05/27/zj1gdvJ4bslWRYD.png" alt="image-20210527091025256" style="zoom:25%;" />

当 LFSR~1~ 输出 $1$ 时，移位时钟脉冲通过与门使 LFSR~2~ 进行一次移位，从而生成下一位；当 LFSR~1~ 输出 $0$ 时，移位时钟脉冲无法通过与门影响 LFSR~2~，LFSR~2~ 重复输出前一位



# 分组密码

## 分组密码运行模式

### 电话本 ECB 模式

- 对明文分组后，用同一密钥逐一加密
- 适合短消息，如传递DES密钥
- 错误不会传播

<img src="https://i.loli.net/2021/05/27/9FyOovkuHjtMS6U.png" alt="image-20210527100550175" style="zoom: 33%;" />

### 密码分组链接 CBC 模式

- $C_i=\text{DES}_K(P_i\oplus C_{i-1}),C_0=IV$
- 可用于消息认证
- 错误传播：当前和下一分组

<img src="https://i.loli.net/2021/05/27/9GhrPnQxWq5TF84.png" alt="image-20210527100947722" style="zoom: 45%;" />

### 密码反馈 CFB 模式

- $j$ 可选 $1$, $8$, $64$ 等， 记作CFB-1, CFB-8, CFB-64
- $1$ 比特密文传输错误传播约 $64/j$ 个分组(不包括当前分组)
- 可用于认证

<img src="https://i.loli.net/2021/05/27/O2kaLVm3uqT1N9I.png" alt="image-20210527101254035" style="zoom: 50%;" />

### 输出反馈 OFB 模式

- 错误不易传播
- 密文易于篡改，不适合认证

<img src="https://i.loli.net/2021/05/27/sRAvXYQym8Iabio.png" alt="image-20210527101431982" style="zoom:50%;" />

### 计数器 CTR 模式

- 效率高，可并行加密，各块可单独处理，可预处理
- 加密数据块可随机访问

<img src="https://i.loli.net/2021/05/27/B72W6RoJ1DOkPZf.png" alt="image-20210527101617230" style="zoom: 40%;" />

## IDEA

### 设计原理

#### 混肴

- 逐比特异或 $\oplus$
- 模 $2^{16}$ 加法 $\boxplus$
- 模 $2^{16}+1$ 乘法 $\odot$，$0000000000000000$ 作 $2^{16}$ 处理

#### 扩散

MA 结构

<img src="https://i.loli.net/2021/05/27/5pSlQ1Zw3hXMeG2.png" alt="image-20210527102825855" style="zoom:25%;" />

### 加密过程

$64$ 比特的明文划分成 $4$ 个 $16$ 比特子段

<img src="https://i.loli.net/2021/05/27/UzbMxiPktKQvNlL.png" alt="image-20210527103037983" style="zoom: 40%;" />

#### 轮结构

- 变换：输入 $4$ 个子段和 $6$ 个子密钥；输出 $4$ 个子段
- 输出变换：仅需 $4$ 个子密钥

#### 子密钥产生

- $Z_1，Z_2，\cdots，Z_8$ 直接从加密密钥中取
- 加密密钥循环左移 $25$ 位，再取 $Z_9，Z_{10}，\cdots，Z_{16}, \cdots$

## AES

<img src="https://i.loli.net/2021/06/03/tJghzOZUmA9TSMG.png" alt="image-20210603111322221" style="zoom: 80%;" />



# 公钥密码

## 公钥密码体制

### 对称密码算法缺陷

- 密钥分配问题：双方保密通信前需要通过安全信道协商密钥
- 密钥管理问题：任何两用户间都需要有共享的秘密钥，$n$ 个用户需要 $C_{n}^{2}$ 个密钥
- 无法实现签名功能：当 Alice 收到 Bob 用其密钥加密生成的电子文挡时，Bob 无法向第三方证明该电子文档确实来源于 Bob

### 双重加密方案

- Alice 发送 $E_A(P)$ 给 Bob

- Bob 发送 $E_B\left(E_A(P)\right)$ 给 Alice
- Alice 发送 $D_A(E_B(E_A(P)))=D_A(E_A(E_B(P)))=E_B(P)$ 给 Bob
- Bob 解密 $D_B(E_B(P))=P$

缺陷：

- 要求构造一个函数, 满足 $E_B(E_A(P))=E_A(E_B(P))$
- 无法验证 Alice 或 Bob 的身份

### 公钥密码体制的基本原理

#### 基于公钥密码体制的加解密过程

- 密钥的生成：生成用户 Alice 的公钥 $PU_a$ 和私钥 $PR_a$
- 公开钥的发布：将 Alice 的公钥 $PU_a$ 公开
- 加密：用户 Bob 想向 Alice 发送消息 $m$，则需获得 Alice 的公钥 $PU_a$ ，然后加密消息$m$得到 $c=E_{PU_a}\left[m\right]$，其中，$E$ 是加密算法
- 解密：Alice 收到密文 $c$ 后，用自己的私钥 $PR_a$ 解密，即 $m=D_{PR_a}\left[c\right]$，其中，$D$ 是解密算法。因为只有 Alice 知道$PR_a$ ，所以其他人无法对密文 $c$ 解密

#### 基于公钥密码体制的认证过程

- 用户 Bob 用自己的私钥 $PR_b$ 对消息 $m$ 加密，表示为 $c=E_{PR_B}\left[m\right]$
- Bob 将 $c$ 发给 Alice。Alice 收到 $c$ 后，用 Bob 的公钥 $PU_B$ 对 $c$ 解密，表示为 $m=D_{PU_B}\left[c\right]$

公钥密码算法运算速度很慢，对较长的明文直接加密用来签名不可行。改进的方法是先将文件经过单向压缩函数(hash)压缩成长度较小的比特串，得到的比特串称为认证符(哈希值) ，然后对认证符(哈希值)进行加密。

#### 基于公钥密码体制的同时实现加密和认证的过程

- 先签名后加密： Alice 首先用自己的私钥 $PR_a$ 对消息 $m$ 加密，用于提供认证(数字签名)；再用 Bob 的公钥 $PU_b$ 第 $2$ 次加密，表示为 $c=E_{PU_b}\left[E_{PR_a}\left[m\right]\right]$
- 先解密再验证： Bob 的解密认证过程为 $m=D_{PU_a}\left[D_{PR_b}\left[c\right]\right]$

### 公钥密码算法应满足的要求

- 密钥对( $PU$ 和 $PR$ )的生成在计算上是容易的
- 用公钥对消息 $m$ 加密，即 $c =E_{PU}[m]$ 在计算上是容易的
- 用私钥对 $c$ 解密，即 $m=D_{PR}[c]$ 在计算上是容易的
- 攻击者由公钥 $PU$ 求私钥 $PR$ 在计算上是不可行的，等同于困难问题
- 攻击者由 $c$ 和公钥 $PU$ 恢复明文 $m$ 在计算上是不可行的，等同于困难问题
- 两个密钥使用的次序可调换，即 $D_{PU}[E_{PR}(m)]=D_{PR}[E_{PU} (m)]$

满足以上要求的本质在于构造一个陷门单向函数

陷门单向函数：若额外给定某些附加信息后，由给定的 $y$ 找到 $x\in X$很容易，则称这样的单向函数为限门单向函数，即：

- 当 $k$ 和 $y$ 已知时，求解 $x=f_k^{-1}(y)$ 很容易
- 当 $y$ 已知但 $k$ 未知时，求解 $x=f_k^{-1}(y)$ 很困难

### 对公钥密码体制的攻击

- 穷搜索攻击
- 寻找从公钥计算私钥的方法
- 可能字攻击

## RSA

### 算法描述

- 密钥的产生
  - 选两个大素数 $p$ 和 $q$
  - 计算 $n=pq$，$\varphi(n)=(p-1)(q-1)$
  - 选一整数 $e$，满足 $1<e<\varphi(n)$，且 $\gcd(\varphi(n), e)=1$
  - 计算 $d$，满足 $de\equiv 1 \mod \varphi(n)$，即 $d$ 是 $e$ 在模 $\varphi(n)$ 下的乘法逆元，$e$ 与 $\varphi(n)$ 互素，模 $\varphi(n)$ 的乘法逆元一定存在
  - 公钥：$\left\{e, n\right\}$；私钥：$\left\{d, p, q\right\}$ 或 $\left\{d\right\}$（密钥生成若是由系统负责完成，则用户可能不知道 $p$ 和 $q$）
- 加密
  - $m<n$，计算 $c\equiv m^e \mod n$
  - 若 $m$ 较大，将 $m$ 分组，每个分组对应的十进制数小于 $n$
- 解密
  - 计算 $m\equiv c^d \mod n$

### 计算问题

#### 加密与解密过程

- 模运算的累次乘法

  $ab\mod n=[(a \mod n)(b\mod n)]\mod n$

- 快速指数算法

  $m=b_{k}2^{k}+b_{k-1}2^{k-1}+\cdots+b_1 2+b_0$

  $a^m=((\cdots(((a^{b_k})^2a^{b_{k-1}})^2a^{b_{k-2}})^2\cdots a^{b_1})^2a^{b_0}$

- 中国剩余定理CRT加速解密

  $m=c^d\mod n\Longleftrightarrow \left\{\begin{matrix}m=c^d\mod p\\m=c^d\mod q\end{matrix}\right.$

  $\Longrightarrow \left\{\begin{matrix}m=a_1\mod p\\m=a_2\mod q\end{matrix}\right.$

  $m=[a_1qq^{-1}+a_2pp^{-1}]\mod n$

### 安全性

- $|p-q|$ 足够大，即 $p$ 和 $q$ 的长度应相差几位
- $p-1$ 和 $q-1$ 均有大素数因子(分别记为 $p'$ 和 $q'$)；$p'-1$ 和 $q'-1$ 也均有大素数因子
- $\gcd(p-1, q-1)$ 应该较小

### 攻击手段

- 共模攻击
- 共指数攻击
- 低指数攻击
- 选择密文攻击(RSA密码算法不能抵抗)

## 背包密码体制

$A=(a_1,a_2,\cdots,a_n)$ 是由 $n$ 个不同的正整数构成的 $n$ 元组，$s$ 是另一已知的正整数。背包问题就是从 $A$ 中找出所有的 $a_i$，使其和等于 $s$。其中，$A$ 称为背包向量，$s$ 是背包容积

将 $x(1\leq x\leq 2n-1)$ 写成长为 $n$ 的二元表示, $f(x)$ 定义为 $A$ 中所有可能选择 $a_i$ 的和，即
$f(1)=f(0\cdots001)=a_n$
$\cdots$
$f(2n-1)=f(1\cdots 111)=a_1+a_2+\cdots+a_n$

背包向量 $A=(a_1,a_2,\cdots,a_n)$ 称为超递增的，如果 $a_j>\sum_\limits{i=1}^{j-1}{a_i},j=2,\cdots,n$

- 密钥产生
  - 构造超递增背包向量 $A=(a_1, a_2, \cdots , a_n)$
  - 用模乘对 $A$ 进行伪装，其中，模数 $k$ 和乘数 $t$ 皆取为常量，满足，$\gcd (t, k)=1$，即 $t$ 在模 $k$ 下有乘法逆元。
  - 设 $b_i\equiv t\cdot a_i \mod k, i=1,2,\cdots,n$，得一新的背包向量 $B=(b_1,b_2,\cdots,b_n)$，记为 $B\equiv t\cdot A \mod k$
  - 用户以 $B$ 作为自己的公钥，$A$ , $t$ , $k$ 为私钥
- 加密
  - 对明文分组 $x=(x_1x_2\cdots x_n)$ 的加密运算为 $c=f(x)=B\cdot B_x \mod k$
- 解密
  - 由 $s \equiv t^{-1}c \mod k$，求出 $s$ 作为超递增背包向量 $A$ 的容积
  - 再由超递增背包向量 $A$ 解背包问题即得 $x=(x_1x_2\cdots x_n)$

## ElGamal密码体制

- 密钥产生
  - 选择大素数 $p$；选择本原根 $g$，$1<g<p$；选择 $x$，$1<x<p-1$
  - 计算 $y=g^x \mod p$，公钥是 $(p, g, y)$，私钥是 $x$
- 加密
  - 明文消息 $M$，$0< M <p$
  - 随机选一整数 $k$ , $1 \leq k \leq p－1$
  - 计算对 $C_1\equiv g^k \mod p$, $C_2\equiv y^kM \mod p$，密文 $C = C1||C2$ (级联)
- 解密
  - $M=C_2/C_1^x \mod p$
  - $C_2/C_1^x \mod p=y^kM/g^{kx}\mod p=y^kM/y^k \mod p=M\mod p$

## 椭圆曲线密码体制

### Diffie-Hellman密钥交换协议

- 取素数 $p\approx 2180$ 和参数 $a$、$b$，则得椭圆曲线上的点及无穷远点构成Abel群 $E_p(a, b)$
- 取 $E_p(a,b)$ 的某个生成元 $G＝(x_1, y_1)$，$G$ 的阶，即满足 $nG=O$ 的最小正整数 $n$很大。$E_p(a, b)$ 和 $G$ 作为公开参数
- Alice 和 Bob 之间的密钥交换如下进行
  - Alice 随机选取保密的整数 $n_A<n$，计算 $P_A=n_AG$ 并发给 Bob
  - Bob 随机选取秘密的 $n_B$ 并计算 $P_B=n_BG$ 发给 Alice
  - Alice 和 Bob 分别由 $K=n_AP_B$ 和 $K=n_BP_A$ 生成共享的密钥 $K=n_AP_B=n_A(n_BG)=n_B(n_AG)=n_BP_A$

### ElGamal密码体制

- 选择椭圆曲线 $E_p(a,b)$，将明文 $m$ 通过嵌入到椭圆曲线上得点 $P_m$
  - 设明文 $m$，计算 $x＝\left\{mk+j, j=0,1,2,\cdots,k-1\right\}$， $k$ 为正整数，通常取值 $30\sim 50$。若 $k＝30$，计算一系列 $x$：$\left\{30m, 30m+1, 30m+2,\cdots\right\}$
  - 直到 $x^3+ax+b(\mod p)$ 是平方剩余，即得到椭圆曲线上的点 $(x,\sqrt{x^3+ax+b} )$
  - 在 $1$ 到 $p-1$ 的整数中，一半是模 $p$ 的平方剩余。$k$ 次找到 $x$，使得 $x^3+ax+b(\mod p)$ 是平方剩余的概率不小于$1－2^{-k}$。
  - 从椭圆曲线上的点 $(x, y)$ 得到 $m$，只须求 $m＝\lfloor x/k\rfloor$
- 取 $E_p(a,b)$ 的一个生成元 $G$，$E_p(a,b)$ 和 $G$ 作为公开参数
- Alice 选 $n_A$ 作为私钥，并以 $P_A=n_AG$ 作为公开钥
- Bob 向 Alice 发送消息 $P_m$，可选取随机数 $k$，产生点对 $C_m=\left\{kG，P_m+kP_A\right\}$ 作为密文
- Alice 以密文点对中的第二个点减去其私钥与第一个点倍乘的结果，即 $(P_m+kP_A)－n_AkG=P_m+k(n_AG)－n_AkG =P_m$



